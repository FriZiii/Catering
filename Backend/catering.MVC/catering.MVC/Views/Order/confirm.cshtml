
@{
    ViewData["Title"] = "Confirm";
}

@using catering.Domain.Entities.OrderEntities;
@model Order

<div class="content">
    <div class="orderdetails-listtitle">
        <h1>Order</h1>
    </div>
        <div class="orders-section">
            <div class="orders-list">
            @foreach (var item in Model.OrderItems)
            {
                <div class="order-item">
                    <div class="orderdetails-image-container">
                        <img src="~/images/products/@item.Product.ImageName" class="orderdetails-image" />
                    </div>
                    <div class="orderdetails-content">
                        <div class="orderdetails-details">
                            <h3 class="orderdetails-title">@item.Product.Name</h3>
                            <h3 class="orderdetails-dot"> . </h3>
                            <h3 class="orderdetails-title orderdetails-yellow-title">@item.Calories kcal</h3>

                            <div class="orderdetails-new-line">
                                <div class="orderdetails-calendar">
                                    <img class="orderdetails-calendar-icon" src="~/images/icons/calendar.svg"
                                         alt="Cal Icon">
                                </div>
                                <p class="orderdetails-date-from">@item.Dates.Min(d => d.Date).ToString("dd.MM.yyyy")</p>
                                    -
                                <p class="orderdetails-date-to">@item.Dates.Max(d => d.Date).ToString("dd.MM.yyyy")</p>
                                <p class="orderdetails-days">Days: @item.Dates.Count</p>
                                <p class="orderdetails-summary-price">$@item.Price</p>
                                    @{
                                        var pricePerDay = item.Price / item.Dates.Count;
                                    }
                                <p class="orderdetails-price-per-day">$@pricePerDay/day</p>
                            </div>

                            <div class="orderdetails-meals">
                                @foreach (var meal in item.Meals)
                                {
                                    <p class="orderdetails-meal-time">@meal.Meal</p>
                                }
                            </div>

                            <div class="orderdetails-buttons">
                                <div class="orderdetails-delete-button">
                                    <form method="post" action="@Url.Action("DeleteOrderItem","Order")">
                                        <input type="hidden" name="orderItemId" value="@item.Id"/>
                                        <button class="orderdetails-link-delete-button">
                                            <img class="orderdetails-delete-icon" src="~/images/icons/trash.svg" alt="Trash Icon">
                                            <span class="orderdetails-delete-span">Delete</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="orderdetails-top-line"> </div>
            }
            <div class="orderdetails-cancel-button-section">
                <form method="post" action="@Url.Action("DeleteOrder", "Order")">
                    <input type="hidden" name="orderId" value="@Model.Id" />
                    <button class="orderdetails-cancel-button">
                        <img class="orderdetails-cancel-icon" src="~/images/icons/x.svg" alt="Trash Icon">
                        <span class="orderdetails-cancel-span">Cancel all</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="summary-section">
                <h2 class="summary-title">Discount codes</h2>
                <div class="summary-discount-section">
                    <form method="post" action="@Url.Action("ApplyDiscountCode", "Order")">
                        <input type="text" placeholder="Enter discount code" class="summary-discount-input" name="discountCode" />
                        <button type="submit" class="summary-apply-button">Apply</button>
                    </form>
                </div>
                <h2 class="summary-title">Summary</h2>
                <div class="summary-prices">
                    <div class="summary-price-left">
                        <p class="summary-price-item">Total</p>
                        <p class="summary-price-item">Discount</p>
                        <p class="summary-price-item summary-total-price">To pay</p>
                    </div>
                    <div class="summary-price-right">
                        <p class="summary-price-item">$@Model.TotalPriceBeforeDiscount</p>
                    @{
                        var x = Model.DiscountCode is null ? "---" : $"-{((Model.TotalPriceBeforeDiscount * Model.DiscountCode.DiscountPercentage) / 100).ToString()}$";
                    }
                    <p class="summary-price-item">@x</p>
                    <p class="summary-price-item summary-total-price">$@Model.TotalPriceAfterDiscount</p>
                    </div>
                </div>
                <button class="summary-button">Go to Summary</button>
            </div>
    </div>
</div>